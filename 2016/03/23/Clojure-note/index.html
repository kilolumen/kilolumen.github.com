<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="DJ"><title>Clojure 学习笔记 | Kilolumen</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 5.4.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Clojure 学习笔记</h1><a id="logo" href="/.">Kilolumen</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Start</i></a><a href="/archives/"><i class="fa fa-archive"> Archiv</i></a><a href="/about/"><i class="fa fa-user"> Über</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Clojure 学习笔记</h1><div class="post-meta">2016-03-23</div><div class="post-content"><span id="more"></span>


<p>；注释以分号开始<br>；Clojure 代码由一个个form组成，即写在小括号里有空格分开的一组语句<br>；Clojure解释器会把第一个元素当做一个函数或者一个宏来调用，其余被认为是参数</p>
<p>ns 指定命名空间 (ns noteclojure)</p>
<p>—————基本<br>str 创建字符串</p>
<ul>
<li><ul>
<li><ul>
<li>\ =<br>not 逻辑非</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>—————类型<br>class 查看类型<br>‘ quote<br>eval 运算求值</p>
<p>—————集合<br>[] 数组<br>‘()链表 (list)<br>coll? 集合<br>seq? 序列<br>rang 序列 (range 4) ; =&gt; (0 1 2 3) , (range) ;=&gt;(0 1 2 3 …), (take 4 (range));=&gt;(0 1 2 3)<br>cons 列表或向量起始位置添加元素 (cons 4 [1 2 3]);=&gt;[4 1 2 3]<br>conj 更高效的添加元素 (conj [1 2 3] 4);=&gt;[1 2 3 4] ,(conj ‘(1 2 3) 4);=&gt; (4 1 2 3)<br>concat 合并列表或向量 (concat [1 2] ‘(3 4)); =&gt; (1 2 3 4)<br>filter 过滤集合元素 (filter even? [1 2 3]); =&gt; (2)<br>map 根据指定的函数映射到一个新的集合 (map inc [1 2 3]); =&gt; (2 3 4)<br>reduce 使用函数来规约集合 (reduce + [1 2 3 4]); = (+ (+ (+ 1 2) 3) 4); =&gt; 10<br>            指定一个初始参数 (reduce conj [] ‘(3 2 1)); = (conj (conj (conj [] 3) 2) 1); ==&gt; [3 2 1]</p>
<p>————–函数<br>fn 创建函数，返回值是最后一个表达式的值 (fn [] “Hello World”); =&gt; fn<br>    嵌套小括号来调用它 ((fn [] “Hello World”)); =&gt; “Hello World”<br>def 创建一个变量var  (def x 1)   x; =&gt; 1<br>      将函数定义为一个变量 (def hello-world (fn [] “Hello World”)) (hello -world); =&gt; “Hello World”<br>defn 简化函数定义  (defn hello-world [] “Hello World”)<br>        中括号的内容是函数的参数  (defn hello [name] (str “Hello” name))  (hello “Steve”)  ;=&gt;”Hello Steve”<br>    简写  (def hello2 #(str “Hello” %1))  (hello2 “Fanny”)<br>    多个参数列表 (defn hello3 ([] “Hello wolrd”) ([name] (str “Hello “ name)))  (hello3 “Jake”);=&gt;”Hello Jake”<br>        (hello3);=&gt; “Hello World”<br>    可以定义变参函数，即把&amp;后面的参数全部放入一个序列<br>    (defn count-args [&amp; args] (str “You passed “ (count args) “ args: “))  (count-args 1 2 3) ;=&gt; “You passed 3 args: (1 2 3)”<br>    可以混用定参和变参（用&amp;来界定）(defn hello-count [name &amp; args] (str “Hello ” name “, you passed “ (count args) “ extra args”))   (hello-count “Finn” 1 2 3) ;=&gt; “Hello Finn, you passed 3 extra args”</p>
<p>————–哈希表<br>；基于hash的map和基于数组的map（即array map），实现了相同的接口，hash map查询比较快，但不保证元素顺序<br>(class {:a 1 :b 2 :c 3})<br>(class (hash-map :a 1 :b 2 :c 3))<br>arraymap在足够大的时候，大多数操作会将其自动转换成hashmap<br>(def stringmap {“a” 1, “b” 2, “c” 3})   stringmap   ;=&gt; {“a” 1, “b” 2, “c” 3}   逗号可有可无<br>(def keymap {:a 1, :b 2, :c 3})   keymap   ;=&gt; {:a 1, :c 3, :b 2}<br>(stringmap “a”)    (keymap :a)   (:b keymap)  (stringmap “d”);=&gt; nil  从map查找元素</p>
<p>assoc 函数来向hashmap添加元素  (def newkeymap (assoc keymap :d 4))   newkemap<br>          newkeymap ;=&gt; {:a 1, :b 2, :c 3, :d 4}   keymap ;=&gt; {:a 1, :b 2, :c 3}  数据类型不可变<br>dissoc 移除元素    (dissoc keymap :a :b) ;=&gt; {:c 3}</p>
<p>————–集合set  #<br>(class #{1 2 3}) ;=&gt; clojure.lang.PersistentHashSet<br>(set [1 2 3 1 2 3 3 2 1 3 2 1]) ;=&gt; #{1 2 3}<br>conj 新增元素  (conj #{1 2 3} 4)  ;=&gt; #{1 2 3 4}<br>disj  移除元素  (disj #{1 2 3} 1)   ; =&gt; #{2 3}<br>(#{1 2 3} 1)   ;=&gt; 1   (#{1 2 3} 4)  ;=&gt; nil 把集合当做函数调用来检查元素是否存在</p>
<p>—————常用的form<br>macro  clojure里的逻辑控制结构都是用宏实现的<br>            (if false “a” “b”)  ;=&gt; “b”<br>            (if false “a”) ;=&gt; nil<br>let        来创建临时的绑定变量  (let [a 1 b 2] (&gt; a b))   ; =&gt; false<br>do        将多个语句组合在一起依次执行  (do (print “Hello”) “World”)  ;=&gt; “World” (spring “Hello”)<br>        函数定义里有一个隐式的do<br>(defn print-and-say-hello [name]<br>  (print “Saying hello to “ name)<br>  (str “Hello “ name) )<br>(pring-and-say-hello “Jeff”)   ;=&gt; “Hello Jeff” (prints “Saying hello to Jeff”);<br>        let也是如此<br>(let [name “burgle”]<br>  (pring “Saying hello to ” name)<br>  (str “Hello ” name) )  ; =&gt; “Hello Urkel” (prints “Saying hello to Urkel”)</p>
<p>—————模块<br>use  用来导入模块里的所有函数<br>        (use ‘clojure.set)<br>        然后可以使用set相关的函数了<br>        (intersection #{1 2 3} #{2 3 4})  ; =&gt; #{2 3}<br>        (difference #{1 2 3} #{2 3 4}) ; =&gt; #{1}</p>
<pre><code>    也可以从一个模块里导入一部分函数
    (use ‘[clojure.set :only [intersection]])
</code></pre>
<p>require  用来导入一个模块    (require ‘clojure.string)<br>/           用来调用模块里的函数   (clojure.string/blank? “”)  ;=&gt; true<br>            在’import’里可以给模块名指定一个较短的别名<br>            (require ‘[clojure.string :as str])  (str/replace “This is a test.” #”[a-o]” str /upper-case) ;=&gt; “THIs Is A tEst.”</p>
<p>#””       用来表示一个正则表达式</p>
<p>:require 可以在一个namespace定义里用:require的方式来require模块（或use，但最好不要用）<br>(ns test<br>  (:require<br>    [clojure.string :as str]<br>    [clojure.set :as set] ))</p>
<p>—————-java<br>import    导入java类   (import java.util.Date)<br>(ns test<br>  (:import java.util.Date<br>               java.util.Calendar ))<br>(Date.)  用类名末尾加’.’的方式来new一个java对象<br>    用’.’操作符来调用方法，或用’.method’的简化方式<br>(. (Date.) getTime)           (.getTime (Date.))<br>    用’/‘调用静态方法<br>(System/currentTimeMillis)<br>    用’doto’来更方便的使用（可变）类<br>(import java.util.Calendar)<br>(doto (Calendar/getInstance)<br>  (.set 2000 1 1 0 0 0)<br>  .getTime )   ;=&gt; A Date. set to 2000-01-01 00:00:00</p>
<p>—————————STM<br>软件内存事务（Software Transactional Memory） 被clojure用来处理持久化的状态</p>
<p>atom   atom是最简单的 (def my-atom (atom {}))<br>swap!  更新atom   (swap! my-atom assoc :a 1) ;=&gt; (assoc {} :a 1)<br>                             (swap! my-atom assoc :b 2) ;=&gt; (assoc {:a 1} :b 2)<br>@        读取atom的值  @my-atom   ;=&gt; {:a 1 :b 2}</p>
<p>下例是一个使用atom实现的简单计数器<br>(def counter (atom 0))<br>(def inc-counter []<br>  (swap! counter inc))</p>
<p>(inc-counter)<br>(inc-counter)<br>(inc-counter)</p>
<p>@counter   ;=&gt;5</p>
<p>其他STM相关的结构是ref和agent</p>
<p>clojure macros</p>
<p>defmacro   定义宏。宏应该输出一个可以作为clojure代码演算的列表<br>(defmacro my-first-macro []<br>  (list reverse “Hello World”))   ; =&gt; (reverse “Hello World”)</p>
<p>使用macroexpand或macroexpand-1查看宏的结果，注意调用需要引用<br>(macroexpand ‘(my-first-macro))</p>
<p>可以直接 eval macroexpand 的结果<br>(eval (macroexpand ‘(my-first-macro)))   ; =&gt; (\d \l \o \r \W \space \o \l \l \e \H)<br>(my-first-macro)  ; =&gt; 同上</p>
<p>创建宏的时候可以使用更简短的引用形式来创建列表<br>(defamer my-first-quoted-macro []<br>  ‘(reverse “Hello World”) )</p>
<p>(macroexpand ‘(my-first-quoted-macro))  ; =&gt; (reverse “Hello World”)  注意reverse不再是一个函数对象，而是一个符号</p>
<p>宏可以传入参数<br>(defmacro inc2 [arg]<br>  (list + 2 arg))</p>
<p>(inc2 2)  ; =&gt; 4</p>
</div><div class="tags"></div><div class="post-nav"><a class="pre" href="/2016/03/24/Sketch-Skill/">Sketch Skill</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://www.ioswifter.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Kategorien</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%94%9F%E6%B4%BB/">生活</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/%E5%AE%A0%E7%89%A9/" style="font-size: 15px;">宠物</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Letzte</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2021/07/07/hello-world/">Hello World</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/10/Install-Hexo/">Install Hexo</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/04/git-cli/">Git 常用命令及使用场景</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/01/British-Shorthair/">British Shorthair</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/22/Mac-Keyboard-shortcut/">Mac Keyboard shortcut</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/13/NSURLSessionDownloadTask-usage/">NSURLSessionDownloadTask后台下载遇到的几种情况</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/22/NSOperationQueue-use/">什么情况下使用NSOperationQueue</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/18/notes-1/">产品记事</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/27/lldb-and-chisel/">lldb and chisel</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/26/Emacs-Keyboard-shortcut/">Emacs Keyboard shortcut</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Blogroll</i></div><ul></ul><a href="https://dribbble.com/" title="Dribbble" target="_blank">Dribbble</a><ul></ul><a href="www.flickr.com/" title="Flickr" target="_blank">Flickr</a><ul></ul><a href="https://pixabay.com" title="Pixabay" target="_blank">Pixabay</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2021 <a href="/." rel="nofollow">Kilolumen.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>